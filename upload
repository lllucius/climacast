#!/bin/sh
#
# Legacy deployment script for self-hosted Lambda
# For Alexa-hosted skills, use git push instead
#
# This script creates a deployment package and uploads it to AWS Lambda

cd lambda

# Clean up any existing package
rm -f ../lambda.zip

# Create deployment package with all files in lambda directory
zip -r9 ../lambda.zip . -x "*.git*" "*.pyc" "__pycache__/*" "*.md"

# Return to root
cd ..

# Show package contents
echo "Package contents:"
unzip -l lambda.zip | head -20
echo "..."
echo ""
echo "Total package size:"
ls -lh lambda.zip

# Upload to Lambda if AWS CLI is configured
if command -v aws &> /dev/null; then
    echo ""
    echo "Uploading to Lambda function 'climacast'..."
    aws lambda update-function-code \
        --function-name climacast \
        --zip-file "fileb://$(pwd)/lambda.zip"
    
    # Clean up
    rm lambda.zip
else
    echo ""
    echo "AWS CLI not found. Deployment package created at lambda.zip"
    echo "Upload manually or install AWS CLI"
fi

